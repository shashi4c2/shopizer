pipeline {
    agent none
    stages {
        stage('GIT') {
            agent {
                label 'ubuntu'
            }
            steps {
                git 'https://github.com/shashi4c2/shopizer.git'
            }
        }
		stage('Build From Maven')
			{
			agent {
				label 'ubuntu'
			}
			steps {
			echo "build with maven"
			sh 'mvn clean install'			}
		}
		stage('Archieve artifacts')
		    {
		    agent {
		        label 'ubuntu'
		    }
		    steps {
		    echo "Artifacts"
		    archiveArtifacts 'sm-shop/target/*.jar, sm-shop/target/*.war'
		    }
		}
		stage('Test Results')
		    {
		    agent {
		        label 'ubuntu'
		    }
		    steps {
		    echo "Results"
		    junit 'sm-shop/target/surefire-reports/*.xml'
		    }
		}
		stage('Deploy')
			{
			agent {
				label 'shashi'
			}
			steps {
			echo "Deploying into webserver"
			sh 'docker container run -d -p 8080:8080 shop:1.0'
			}
		}
	}
}